<h2>Relatório de Vendas</h2>

<div class="error" *ngIf="error">{{ error }}</div>

<div class="form-wrapper">
  <h3>Filtros</h3>

  <form [formGroup]="filtroForm" (ngSubmit)="buscar()">
    <div class="filters">
      <div>
        <label>Usuário</label>
        <select formControlName="usuarioId">
          <option [ngValue]="null">Todos</option>
          <option *ngFor="let u of usuarios" [value]="u.id">
            {{ u.nomeCompleto }}
          </option>
        </select>
      </div>

      <div>
        <label>Início (data/hora)</label>
        <input type="datetime-local" formControlName="inicio" />
      </div>

      <div>
        <label>Fim (data/hora)</label>
        <input type="datetime-local" formControlName="fim" />
      </div>

      <div>
        <label>Valor mínimo</label>
        <input type="number" formControlName="valorMin" step="0.01" />
      </div>

      <div>
        <label>Valor máximo</label>
        <input type="number" formControlName="valorMax" step="0.01" />
      </div>
    </div>

    <button type="submit">Buscar</button>
  </form>
</div>

<h3>Vendas</h3>

<p><strong>Total Geral:</strong> {{ totalGeral() | currency:'BRL' }}</p>

<table class="table">
  <thead>
  <tr>
    <th>ID</th>
    <th>Data/Hora</th>
    <th>Usuário</th>
    <th>Valor Total</th>
    <th>Recebido</th>
    <th>Troco</th>
    <th>Itens</th>
  </tr>
  </thead>
  <tbody>
  <tr *ngFor="let v of vendas">
    <td>{{ v.id }}</td>
    <td>{{ v.dataHora | date:'short' }}</td>
    <td>{{ v.usuarioNome }}</td>
    <td>{{ v.valorTotal | currency:'BRL' }}</td>
    <td>{{ v.valorRecebido | currency:'BRL' }}</td>
    <td>{{ v.troco | currency:'BRL' }}</td>
    <td>
      <ul>
        <li *ngFor="let it of v.itens">
          {{ it.produtoNome }} - {{ it.quantidade }} x
          {{ it.precoUnitario | currency:'BRL' }}
          = {{ it.subtotal | currency:'BRL' }}
        </li>
      </ul>
    </td>
  </tr>
  </tbody>
</table>
